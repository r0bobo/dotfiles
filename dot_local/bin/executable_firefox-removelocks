#!/bin/bash -eu

DIR=$HOME/.mozilla/firefox


if [[ -d "$DIR" ]]; then
    mapfile -d '' locks < <(
        find "$DIR" -type f -name .parentlock -print0
        find "$DIR" -type l -name lock -print0
    )
fi


if [[ "${#locks[@]}" == 0 ]]; then
    >&2 echo "No locks found"
    exit
fi


>&2 echo 'Firefox will be killed. Continue? [yn]'
read cont

[[ "$cont" != "y" ]] && exit 1

killall firefox

rm -v "${locks[@]}"
